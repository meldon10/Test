sap.ui.define(["adminconfiguration/adminconfiguration/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","adminconfiguration/adminconfiguration/util/Constants","sap/ui/model/resource/ResourceModel","adminconfiguration/adminconfiguration/util/Utils"],function(e,a,t,n,i,o){"use strict";return e.extend("adminconfiguration.adminconfiguration.controller.Admin",{onInit:function(){$.ajax({async:false,type:"GET",url:"/odata/v4/sap/opu/odata/sap/IssueConfiguration",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){this.setValue(e.value)}.bind(this)});var a=o.fetchCsrfToken("/odata/v4/sap/opu/odata/sap/IssueConfiguration",e);var t=this.getComponentModel("security");a.then(e=>{t.setProperty("/csrf_token",e)})},onPressUpdate:function(){var e=this.getModel("businessConfigurationData").getData().colorConfiguration;var a=this.getI18nModel();var n=a.getResourceBundle();var i=this.getComponentModel("security");var o=n.getText("updatedSuccessfully");var u=n.getText("updationFailed");for(var r in e){var s=this.deleteMinMaxEnabled(e[r],r);OData.request({requestUri:"/odata/v4/sap/opu/odata/sap/IssueConfiguration("+s.ID+")",method:"PUT",headers:{"X-CSRF-Token":i.getProperty("/csrf_token")},data:s},function(e){console.log(e)},function(e){if(e.response.statusCode==200){t.show(o)}else{console.log(e.message);t.show(e.message)}})}this.setValue(e)},deleteMinMaxEnabled:function(e){delete e.minimumValueEnabled;delete e.maximumValueEnabled;delete e.valueState;delete e.valueStateText;var a=this.getI18nModel();var t=a.getResourceBundle();var i=t.getText("maxValue");var o=t.getText("minValue");if(e.maximumValue==i){e.maximumValue=n.Values.Max}else if(e.minimumValue==o){e.minimumValue="0"}return e},setValue:function(e){var t=this.getMinimumMaximumEnabling(e);var n={};n.colorConfiguration=t;n.btnEnable=true;var i=new a(n);if(this.getView()!=undefined){this.setModel(i,"businessConfigurationData")}},getMinimumMaximumEnabling:function(e){for(var a=0;a<e.length;a++){var t=this.getI18nModel();var i=t.getResourceBundle();var o=i.getText("maxValue");var u=i.getText("minValue");if(e[a].color.toLowerCase()==n.SpotsColor.Red.toLowerCase()){e[a].maximumValue=o;e[a].minimumValueEnabled=true;e[a].maximumValueEnabled=false;e[a].valueState=n.Values.None;e[a].valueStateText=""}else if(e[a].color.toLowerCase()==n.SpotsColor.Amber.toLowerCase()){e[a].minimumValueEnabled=true;e[a].maximumValueEnabled=false;e[a].valueState=n.Values.None;e[a].valueStateText=""}else if(e[a].color.toLowerCase()==n.SpotsColor.Green.toLowerCase()){e[a].minimumValue=u;e[a].minimumValueEnabled=false;e[a].maximumValueEnabled=false}}return e},onMinValueChange:function(e){var a=this.getI18nModel();var t=a.getResourceBundle();var i=t.getText("greaterThanMsg");var o=t.getText("cannotBeZero");var u=t.getText("lesserOrEqual");var r=t.getText("validNumber");var s=t.getText("correctionOfRed");var l=e.getParameter("newValue");var m=this.getModel("businessConfigurationData");var d=this.getModel("businessConfigurationData").getData().colorConfiguration;var f=e.getSource().getBindingContext("businessConfigurationData").getPath();var g=this.byId("idAdminTable");var v=g.indexOfRow(e.getSource().getParent());d[v].minimumValue=l;var c=this.calculateTheValue(l);d[v].valueState=n.Values.None;m.setProperty("/btnEnable",true);if(!Number(l)){d[v].valueState=n.SpotsType.Error;d[v].valueStateText=r;m.setProperty("/btnEnable",false)}if(v==0){if(d[1].minimumValue!=""&&parseInt(l)<=parseInt(d[1].minimumValue)){d[v].valueState=n.SpotsType.Error;d[v].valueStateText=i+" "+parseInt(d[1].minimumValue);m.setProperty("/btnEnable",false)}}if(v==1){var p=d[1].maximumValue;if(parseInt(l)>parseInt(p)||parseInt(l)==0){d[v].valueState=n.SpotsType.Error;m.setProperty("/btnEnable",false);if(parseInt(l)==0){d[v].valueStateText=o}else if(parseInt(p)<0){d[v].valueStateText=s}else{d[v].valueStateText=u+" "+p}}}if(parseInt(l)<0){d[v].valueState=n.SpotsType.Error;d[v].valueStateText=r;m.setProperty("/btnEnable",false)}if(parseInt(l)==0){d[v].valueState=n.SpotsType.Error;d[v].valueStateText=o;m.setProperty("/btnEnable",false)}d[v+1].maximumValue=c;this.checkTheValidations(v);this.getModel("businessConfigurationData").updateBindings()},checkTheValidations:function(e){var a=this.getModel("businessConfigurationData").getData().colorConfiguration;if(e==1&&parseInt(a[0].minimumValue)!="0"&&!(parseInt(a[0].minimumValue)<0)&&a[0].minimumValue>a[1].minimumValue){a[0].valueState=n.Values.None}else if(parseInt(a[1].minimumValue)<=parseInt(a[1].maximumValue)&&parseInt(a[1].minimumValue)!="0"&&!(parseInt(a[1].minimumValue)<0)){a[1].valueState=n.Values.None}},calculateTheValue:function(e){var a=(parseInt(e)-1).toString();if(a==n.Values.NaN){a=""}return a}})});