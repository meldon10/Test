sap.ui.define(["com/sap/acs/ui/dashboard/controller/BaseController","sap/ui/model/json/JSONModel","com/sap/acs/ui/dashboard/util/Constants","com/sap/acs/ui/dashboard/util/formatter","com/sap/acs/ui/dashboard/util/MapConfig","sap/ui/core/Fragment","sap/m/MessageBox","com/sap/acs/ui/dashboard/util/Utils"],function(e,t,i,s,o,r,n,a){return e.extend("com.sap.acs.ui.dashboard.controller.DashboardACS",{formatter:s,onInit:function(){this.aMessage=[];var e=this.getComponentModel("message");var t=this.getAdminConfiguration();var s=this.getComponentModel("shared");var o=this.getControl("idMessagePopoverButton");var r=this.getComponentModel("shared");var n=this.getComponentModel("visibility");var u=this.getI18nModel();var c=u.getResourceBundle();t.then(function(e){if(e.length===i.ErrorMessage.valueMessageLen){this.setError(c.getText("noadmin"))}this.setFooterVisibleError(this.aMessage);s.setProperty("/admin",e)}.bind(this));var l={taskName:"",valueStateTaskName:"None",valueStateTextTaskName:"",taskDesc:"",valueStateTaskNameDesc:"None",valueStateTextTaskNameDesc:"",highPriority:false,mediumPriority:true,lowPriority:false,status:"1",dueDate:new Date,minDate:new Date,valueStateDueDate:"None",valueStateTextDueDate:"",createUpdateToDoFormTitle:"",checked:false};s.setProperty("/createEditTask",l);s.setProperty("/oSelectedTask",{});var p={quickLinkName:"",quickLinkUrl:"",valueStateNameQuickLinks:"None",valueStateTextNameQuickLinks:"",valueStateUrlQuickLinks:"None",valueStateTextUrlQuickLinks:""};s.setProperty("/createQuickLinks",p);s.setProperty("/oSelectedQuickLink",{});s.setProperty("/oMapHeight","auto");e.setProperty("/item",[]);e.setProperty("/messageSize","");this.setCountry();this.setMapData();this.setMyToDoList();this.setQuickLinks();this.setWorkList();var d=a.fetchCsrfToken("/odata/v4/TodoService/task");var g=this.getComponentModel("security");d.then(function(e){g.setProperty("/csrf_token",e)}.bind(this))},getAdminConfiguration:function(){var e=this.getComponentModel("visibility"),t=this.getI18nModel(),i=t.getResourceBundle();return new Promise(function(e,t){$.ajax({url:"/odata/v4/sap/opu/odata/sap/IssueConfiguration",async:true,success:function(t,i){e(t.value)}.bind(this),error:function(e){this.setError(i.getText("noadmin"));t()}.bind(this)})}.bind(this))},setCountry:function(){var e=this.getComponentModel("visibility"),t=this.getI18nModel(),s=t.getResourceBundle();$.get({url:"/odata/v4/CustomerServiceOrder/Country",success:function(e){if(e.value.length===i.ErrorMessage.valueMessageLen){this.setError(s.getText("nocountry"))}else{var t=this.getComponentModel("shared");t.setProperty("/country",e.value)}this.setFooterVisibleError(this.aMessage)}.bind(this),error:function(e){this.setError(s.getText("nocountry"))}.bind(this)})},onSearchFilterBar:function(){var e=this.getControl("idACSDashFilterBar"),t=e.getFilterItems(),s=null,o=true,r=this.getComponentModel("visibility"),n=this.getComponentModel("shared"),a=this.getControl("idMessagePopoverButton"),u=this.getI18nModel(),c=u.getResourceBundle(),l=[],p=this.getComponentModel("message"),d=this.getControl("idmap"),g=i.ZoomMaps.valueMinLenZoom,k=i.ZoomMaps.valueMapslats,h=i.ZoomMaps.valueMapslons,y=[];this.aMessage=[];p.setProperty("/item",this.aMessage);p.updateBindings(true);t.map(function(e){s=e.getControl();switch(s.getMetadata().getName()){case"sap.m.Input":if(s.getValue()){l.push(e.getName()+" eq "+"'"+s.getValue()+"'");o=false}break;case"sap.m.MultiComboBox":if(s.getSelectedKeys().length){var t=[...new Set(s.getSelectedKeys())];t.map(function(t){y.push(e.getName()+" eq "+"'"+t+"'")});o=false}break}}.bind(this));if(o){this.setError(c.getText("nofilterEntered"));n.setProperty("/mapSpots",{})}else{var P=n.getProperty("/admin"),T=this.getBusinessPatrner(l,y);T.then(function(e){if(e.length){var t=this.fnsetZoomGeocode(e);if(t.alons.length&&t.alats.length){if(t.alons.length==k&&t.alats.length==k){d.zoomToGeoPosition(t.alons,t.alats,g)}else{d.zoomToGeoPosition(t.alons,t.alats)}}var i=this.setMapSpotsColor(e,P);n.setProperty("/mapSpots",i);this.setFooterVisibleError(this.aMessage)}else{n.setProperty("/mapSpots",{});this.setError(c.getText("noDataText"))}r.setProperty("/BusyAppView",false)}.bind(this))}r.updateBindings()},getBusinessPatrner:function(e,t){var i="/odata/v4/CustomerServiceOrder/BusinessPartner?$filter=",s=this.getI18nModel(),o=s.getResourceBundle(),r=e.join(" and "),n=t.join(" or "),a="",u=this.getComponentModel("visibility");if(r.length){if(n.length){a=r.concat(" and ",n)}else{a=r}}else{a=n}u.setProperty("/BusyAppView",true);sFinalURL=i+a+"&$expand=service_orders";return new Promise(function(e,t){$.ajax({url:sFinalURL,type:"GET",async:true,contentType:"application/json",success:function(t,i){e(t.value)}.bind(this),error:function(e){u.setProperty("/BusyAppView",false);if(e.responseText){var i=JSON.parse(e.responseText);this.setError(i.error.message)}t()}.bind(this)})}.bind(this))},setMapSpotsColor:function(e,t){var s,o=i.MaxValue.Max,r=i.SpotsColor.Default;for(var n=0;n<e.length;n++){var a=i.MaxValue.InitializationServiceOrder;a=e[n].service_orders.length;for(var u=0;u<t.length;u++){if(t[u].maximumValue===o&&a>=parseInt(t[u].minimumValue)){e[n].colorSpots=t[u].color}else if(a>=parseInt(t[u].minimumValue)&&a<=parseInt(t[u].maximumValue)){e[n].colorSpots=t[u].color}else if(t[u].minimumValue===i.MaxValue.DefaultValue||t[u].maximumValue===i.MaxValue.DefaultValue){e[n].colorSpots=r}}}return e},setMapData:function(){var e=this.getControl("idmap");this.oMapConfig=o;if(e){e.setMapConfiguration(this.oMapConfig);e.setRefMapLayerStack("Default")}},onClickSpot:function(e){oSource=e.getSource();var t=oSource.getBindingContext("shared").getPath();var i=this.getControl("idmap");var s=this.getControl("idMapContainer");s.setFullScreen(false);this.getRouter().navTo("customerDetail",{details:window.encodeURIComponent(t)})},onSelectionChangeSegmentedButtonMaps:function(e){var t=e.getSource(),s=t.getSelectedKey(),o=this.getComponentModel("shared");oVisibilityModel=this.getComponentModel("visibility");if(s===i.SegmentedItem.Maps){oVisibilityModel.setProperty("/mapVisibility",true);oVisibilityModel.setProperty("/listVisibility",false);o.setProperty("/oMapHeight","auto")}else if(s===i.SegmentedItem.List){oVisibilityModel.setProperty("/mapVisibility",false);oVisibilityModel.setProperty("/listVisibility",true);o.setProperty("/oMapHeight","100%")}oVisibilityModel.updateBindings();o.updateBindings()},setMyToDoList:function(){var e=this.getComponentModel("shared"),t=this.getI18nModel(),s=t.getResourceBundle(),o=this.getComponentModel("visibility"),r=this.getComponentModel("user");o.setProperty("/BusyAppView",true);$.ajax({url:"/odata/v4/TodoService/task?$filter=status eq '"+i.Status.OPen+"'",type:i.Operation.GET,async:true,contentType:"application/json",success:function(t,i){var t=t.value,s=this.getDisplayToList(t);e.setProperty("/myToDoList",s);o.setProperty("/BusyAppView",false);this.setFooterVisibleError(this.aMessage)}.bind(this),error:function(e){o.setProperty("/BusyAppView",false);this.setError(s.getText("notodolist"))}.bind(this)})},getDisplayToList:function(e){e.map(function(t,i){e[i].due_by=new Date(t.due_by)});return e},getMyToDoCreateUpdateFragment:function(){var e=this.getView();if(!this._oCreateMyToDoTask){this._oCreateMyToDoTask=r.load({id:e.getId(),name:"com.sap.acs.ui.dashboard.view.fragments.CreateEditTask",controller:this}).then(function(t){e.addDependent(t);return t})}this._oCreateMyToDoTask.then(function(e){e.open()})},onPressCreateMyToDoTask:function(){var e=this.getComponentModel("visibility"),t=this.getComponentModel("shared"),i=this.getI18nModel(),s=i.getResourceBundle();e.setProperty("/SaveButton",false);e.setProperty("/AddButton",true);e.setProperty("/MarkASComplete",false);t.setProperty("/createEditTask/createUpdateToDoFormTitle",s.getText("addTasks"));this.getMyToDoCreateUpdateFragment()},onPressCreateQuickLinksAdd:function(){var e=this.getComponentModel("visibility"),t=this.getComponentModel("shared"),i=this.getI18nModel(),s=i.getResourceBundle();e.setProperty("/SaveQuickLinkButton",false);e.setProperty("/AddQuickLinkButton",true);t.setProperty("/createQuickLinks/createUpdateQuickLinkTitle",s.getText("addQuickLinks"));this.onPressCreateUpdateQuickLinks()},onPressCreateUpdateQuickLinks:function(){var e=this.getView();if(!this._oCreateQuickLinks){this._oCreateQuickLinks=r.load({id:e.getId(),name:"com.sap.acs.ui.dashboard.view.fragments.CreateQuickLink",controller:this}).then(function(t){e.addDependent(t);return t})}this._oCreateQuickLinks.then(function(e){e.open()})},onBeforeOpenCreateEditTaskDialog:function(){var e=this.getComponentModel("shared");if(Object.keys(e.getProperty("/oSelectedTask")).length){e.setProperty("/createEditTask/taskName",e.getProperty("/oSelectedTask/task_name"));e.setProperty("/createEditTask/taskDesc",e.getProperty("/oSelectedTask/task_description"));e.setProperty("/createEditTask/dueDate",e.getProperty("/oSelectedTask/due_by"));if(Number(e.getProperty("/oSelectedTask/priority"))===i.Priority.One){e.setProperty("/createEditTask/lowPriority",true)}else if(Number(e.getProperty("/oSelectedTask/priority"))===i.Priority.Two){e.setProperty("/createEditTask/mediumPriority",true)}else if(Number(e.getProperty("/oSelectedTask/priority"))===i.Priority.Three){e.setProperty("/createEditTask/highPriority",true)}}},onBeforeOpenCreateQuickLinkDialog:function(){var e=this.getComponentModel("shared");if(Object.keys(e.getProperty("/oSelectedQuickLink")).length){e.setProperty("/createQuickLinks/quickLinkName",e.getProperty("/oSelectedQuickLink/quickLink_name"));e.setProperty("/createQuickLinks/quickLinkUrl",e.getProperty("/oSelectedQuickLink/quickLink_URL"))}},onBeforeCloseCreateEditTaskDialog:function(){var e=this.getComponentModel("shared");e.setProperty("/createEditTask/taskName","");e.setProperty("/createEditTask/valueStateTaskName",i.SpotsType.None);e.setProperty("/createEditTask/valueStateTextTaskName","");e.setProperty("/createEditTask/taskDesc","");e.setProperty("/createEditTask/valueStateTaskNameDesc",i.SpotsType.None);e.setProperty("/createEditTask/valueStateTextTaskNameDesc","");e.setProperty("/createEditTask/highPriority",false);e.setProperty("/createEditTask/mediumPriority",true);e.setProperty("/createEditTask/lowPriority",false);e.setProperty("/createEditTask/status",i.Priority.One.toString());e.setProperty("/createEditTask/dueDate",new Date);e.setProperty("/createEditTask/valueStateDueDate",i.SpotsType.None);e.setProperty("/createEditTask/valueStateTextDueDate","");e.setProperty("/createEditTask/checked",false);e.setProperty("/oSelectedTask",{})},onBeforeCloseCreateQuickLinkDialog:function(){var e=this.getComponentModel("shared");e.setProperty("/createQuickLinks/quickLinkName","");e.setProperty("/createQuickLinks/quickLinkUrl","");e.setProperty("/createQuickLinks/valueStateNameQuickLinks",i.SpotsType.None);e.setProperty("/createQuickLinks/valueStateTextNameQuickLinks","");e.setProperty("/createQuickLinks/valueStateUrlQuickLinks",i.SpotsType.None);e.setProperty("/createQuickLinks/valueStateTextUrlQuickLinks","");e.setProperty("/oSelectedQuickLink",{})},onPressClose:function(){this._oCreateMyToDoTask.then(function(e){e.close()})},onPressCloseQuickLink:function(){this._oCreateQuickLinks.then(function(e){e.close()})},createUpdateToDoTask:function(e,t){var s=this.getComponentModel("visibility"),o="",r="",a=this.getI18nModel(),u=this.getComponentModel("message"),c=a.getResourceBundle(),l=this.getComponentModel("shared"),p=l.getProperty("/createEditTask"),d=this.getComponentModel("security"),g="",k="";if(!this.getValidationCheck(c)){g=this.getPriority(p),k=this.getStatus(p);jsonString=JSON.stringify(this.getPayloadPUTPOST(p,g,k));this.aMessage=[];u.setProperty("/item",this.aMessage);u.updateBindings(true);s.setProperty("/BusyAppView",true);$.ajax({url:t,type:e,async:true,headers:{"X-CSRF-Token":d.getProperty("/csrf_token")},contentType:"application/json",data:jsonString,success:function(t,r){this.onPressClose();s.setProperty("/BusyAppView",false);s.setProperty("/FooterVisibility",false);o=e===i.Operation.PUT?c.getText("successUpdateToDoTaskMessage"):c.getText("successCreateToDoTaskMessage");n.success(o,{title:c.getText("success"),actions:n.Action.OK,onClose:function(e){this.setMyToDoList()}.bind(this)})}.bind(this),error:function(t){s.setProperty("/BusyAppView",false);r=e===i.Operation.POST?c.getText("taskcreationfailed"):c.getText("taskupdatingfailed");this.setError(r)}.bind(this)})}},createUpdateLinks:function(e,t){var s=this.getComponentModel("shared"),o=s.getProperty("/createQuickLinks"),r=this.getComponentModel("visibility"),a="",u="",c=this.getComponentModel("message"),l=this.getI18nModel(),p,d=this.getComponentModel("security"),g=l.getResourceBundle();if(!this.getValidationCheckLinks(g)){p=JSON.stringify(this.getPayloadPUTPOSTLinks(o));this.aMessage=[];c.setProperty("/item",this.aMessage);c.updateBindings(true);r.setProperty("/BusyAppView",true);$.ajax({url:t,type:e,async:true,headers:{"X-CSRF-Token":d.getProperty("/csrf_token")},contentType:"application/json",data:p,success:function(t,s){this.onPressCloseQuickLink();r.setProperty("/BusyAppView",false);r.setProperty("/FooterVisibility",false);a=e===i.Operation.POST?g.getText("quicklinkcreatedsuccess"):g.getText("quicklinkupdatedsuccess");n.success(a,{title:g.getText("success"),actions:n.Action.OK,onClose:function(e){this.setQuickLinks()}.bind(this)})}.bind(this),error:function(t){r.setProperty("/BusyAppView",false);u=e===i.Operation.POST?g.getText("quicklinkcreationfailed"):g.getText("quicklinkupdatingfailed");this.setError(u)}.bind(this)})}},getValidationCheck:function(e){var t=false,s=this.getControl("idTaskNameInput"),o=this.getControl("idTaskDescriptionTextArea"),r=this.getControl("idDatePickerCreateEditTask"),n=this.getComponentModel("shared"),a=n.getProperty("/createEditTask");if(!a.taskName){n.setProperty("/createEditTask/valueStateTaskName",i.SpotsType.Error);n.setProperty("/createEditTask/valueStateTextTaskName",e.getText("validationTaskName"));s.openValueStateMessage();t=true}if(!a.taskDesc){n.setProperty("/createEditTask/valueStateTaskNameDesc",i.SpotsType.Error);n.setProperty("/createEditTask/valueStateTextTaskNameDesc",e.getText("validationTaskDesc"));o.openValueStateMessage();t=true}if(!a.dueDate){n.setProperty("/createEditTask/valueStateDueDate",i.SpotsType.Error);n.setProperty("/createEditTask/valueStateTextDueDate",e.getText("validationDueDate"));r.openValueStateMessage();t=true}return t},getValidationCheckLinks:function(e){var t=false,s=this.getControl("idQuickLinksNameInput"),o=this.getControl("idQuickLinksUrlInput"),r=this.getComponentModel("shared"),n=new RegExp(/^(ftp|http|https):\/\/[^ "]+$/);oPropertyQuickLink=r.getProperty("/createQuickLinks");if(!oPropertyQuickLink.quickLinkName){r.setProperty("/createQuickLinks/valueStateNameQuickLinks",i.SpotsType.Error);r.setProperty("/createQuickLinks/valueStateTextNameQuickLinks",e.getText("valueStateTextNameQuickLinks"));s.openValueStateMessage();t=true}if(!oPropertyQuickLink.quickLinkUrl){r.setProperty("/createQuickLinks/valueStateUrlQuickLinks",i.SpotsType.Error);r.setProperty("/createQuickLinks/valueStateTextUrlQuickLinks",e.getText("valueStateTextUrlQuickLinks"));o.openValueStateMessage();t=true}if(oPropertyQuickLink.quickLinkUrl){if(!n.test(oPropertyQuickLink.quickLinkUrl)){r.setProperty("/createQuickLinks/valueStateUrlQuickLinks",i.SpotsType.Error);r.setProperty("/createQuickLinks/valueStateTextUrlQuickLinks",e.getText("valueStateTextValidUrlQuickLinks"));o.openValueStateMessage();t=true}}return t},onPressDeleteMyToDoTask:function(e){var t=this.getView(),i=this.getI18nModel(),s=i.getResourceBundle(),o=null,n="";this._oBindingContext=e.getSource().getBindingContext("shared");if(!this._oDeleteMyToDoTask){this._oDeleteMyToDoTask=r.load({id:t.getId(),name:"com.sap.acs.ui.dashboard.view.fragments.ConfirmDialog",controller:this}).then(function(e){t.addDependent(e);return e})}this._oDeleteMyToDoTask.then(function(e){e.open();o=this.getControl("idDeleteTaskPanelText");n=s.getText("confirmationDeleteToDoTaskMessage")+' \n "'+this._oBindingContext.getProperty("task_name")+'"'+"?";o.setText(n)}.bind(this))},onPressDeleteTask:function(){var e=this._oBindingContext.getProperty("TASK_ID"),t=this.getI18nModel(),s=t.getResourceBundle(),o=this.getComponentModel("message"),r=this.getComponentModel("visibility");this.aMessage=[];o.setProperty("/item",this.aMessage);o.updateBindings(true);var a=this.getComponentModel("security");r.setProperty("/BusyAppView",true);$.ajax({url:"/odata/v4/TodoService/task("+e+")",type:i.Operation.DELETE,async:true,headers:{"X-CSRF-Token":a.getProperty("/csrf_token")},contentType:"application/json",success:function(e,t){this.onPressCancel();o=this.getComponentModel("message");r.setProperty("/BusyAppView",false);r.setProperty("/FooterVisibility",false);n.success(s.getText("successDeleteToDoTaskMessage"),{title:s.getText("success"),actions:n.Action.OK,onClose:function(e){this.setMyToDoList()}.bind(this)})}.bind(this),error:function(e){this.setError(s.getText("taskdeletionfailed"));r.setProperty("/BusyAppView",false)}.bind(this)})},onPressDeleteQuickLinkDialog:function(e){var t=this.getView(),i=this.getI18nModel(),s=i.getResourceBundle(),o=null,n="";this._oBindingContextQuickLink=e.getSource().getBindingContext("shared");if(!this._oDeleteQuickLink){this._oDeleteQuickLink=r.load({id:t.getId(),name:"com.sap.acs.ui.dashboard.view.fragments.DeleteQuickLink",controller:this}).then(function(e){t.addDependent(e);return e})}this._oDeleteQuickLink.then(function(e){e.open();o=this.getControl("idDeleteQuickLinkPanelText");n=s.getText("confirmationDeleteQuickLinkMessage")+' \n "'+this._oBindingContextQuickLink.getProperty("quickLink_name")+'"'+"?";o.setText(n)}.bind(this))},onPressDeleteQuickLink:function(e){var t=this._oBindingContextQuickLink.getProperty("QUICKLINK_ID");var s=this.getI18nModel(),o=this.getControl("idQuickLinkList"),r=this.getComponentModel("shared"),a=this.getComponentModel("visibility");oResourceBundle=s.getResourceBundle(),oMessageModel=this.getComponentModel("message");this.aMessage=[];oMessageModel.setProperty("/item",this.aMessage);oMessageModel.updateBindings(true);var u=this.getComponentModel("security");a.setProperty("/BusyAppView",true);$.ajax({url:"/odata/v4/QuickLinksService/quickLink("+t+")",type:i.Operation.DELETE,async:true,headers:{"X-CSRF-Token":u.getProperty("/csrf_token")},contentType:"application/json",success:function(e,t){this.onPressCancelQuickLink();oMessageModel=this.getComponentModel("message");a.setProperty("/BusyAppView",false);a.setProperty("/FooterVisibility",false);n.success(oResourceBundle.getText("quicklinkdeletedsuccess"),{title:oResourceBundle.getText("success"),actions:n.Action.OK,onClose:function(e){this.setQuickLinks()}.bind(this)})}.bind(this),error:function(e){this.setError(oResourceBundle.getText("quicklinkdeletionfailed"));a.setProperty("/BusyAppView",false)}.bind(this)})},onLiveChangeCreateEditTask:function(e){var t=e.getSource();t.setValueState(i.SpotsType.None);t.setValueStateText("")},onLiveChangeCreateQuickLinks:function(e){var t=e.getSource();t.setValueState(i.SpotsType.None);t.setValueStateText("")},onPressCancel:function(){this._oDeleteMyToDoTask.then(function(e){e.close()})},onPressCancelQuickLink:function(){this._oDeleteQuickLink.then(function(e){e.close()})},onPressChangeMyToDoList:function(e){var t=this.getComponentModel("visibility"),i=this.getComponentModel("shared"),s=this.getI18nModel(),o=s.getResourceBundle();t.setProperty("/SaveButton",true);t.setProperty("/AddButton",false);t.setProperty("/MarkASComplete",true);i.setProperty("/createEditTask/createUpdateToDoFormTitle",o.getText("editTasks"));i.setProperty("/oSelectedTask",e.getSource().getBindingContext("shared").getObject());this.getMyToDoCreateUpdateFragment()},getPriority:function(e){var t="";if(e.lowPriority){t=i.Priority.One.toString()}else if(e.mediumPriority){t=i.Priority.Two.toString()}else if(e.highPriority){t=i.Priority.Three.toString()}return t},getStatus:function(e){var t="";if(e.checked){t=i.Priority.Three.toString()}else{t=e.status}return t},getPayloadPUTPOST:function(e,t,i){return oPayload={task_name:e.taskName,task_description:e.taskDesc,status:i,due_by:s.getFormattedDate(e.dueDate),priority:t}},getPayloadPUTPOSTLinks:function(e){return oPayloadQuickLinks={quickLink_name:e.quickLinkName,quickLink_URL:e.quickLinkUrl}},onPressCreateEditTaskAdd:function(){var e=i.Operation.POST,t="/odata/v4/TodoService/task";this.createUpdateToDoTask(e,t)},onPressUpdateEditTaskAdd:function(){var e=this.getComponentModel("shared"),t=i.Operation.PUT,s="/odata/v4/TodoService/task("+e.getProperty("/oSelectedTask/TASK_ID")+")";this.createUpdateToDoTask(t,s)},onPressCreateQuickLinksModifyAdd:function(){var e=i.Operation.POST,t="/odata/v4/QuickLinksService/quickLink";this.createUpdateLinks(e,t)},onPressEditQuickLinkModify:function(){var e=this.getComponentModel("shared"),t=i.Operation.PUT,s="/odata/v4/QuickLinksService/quickLink("+e.getProperty("/oSelectedQuickLink/QUICKLINK_ID")+")";this.createUpdateLinks(t,s)},setQuickLinks:function(){var e=this.getComponentModel("shared"),t=this.getI18nModel(),i=t.getResourceBundle(),s=this.getComponentModel("visibility");s.setProperty("/BusyAppView",true);$.ajax({url:"/odata/v4/QuickLinksService/quickLink",type:"GET",async:true,contentType:"application/json",success:function(t,i){var o=t.value;e.setProperty("/quickLink",o);e.updateBindings(true);s.setProperty("/BusyAppView",false);this.setFooterVisibleError(this.aMessage)}.bind(this),error:function(e){s.setProperty("/BusyAppView",false);this.setError(i.getText("noquicklinks"))}.bind(this)})},onPressLink:function(e){var t=e.getSource().getBindingContext("shared").getProperty("quickLink_URL");sap.m.URLHelper.redirect(t,true)},onPressEditQuickLink:function(e){var t=this.getComponentModel("visibility"),i=e.getSource().getBindingContext("shared"),s=this.getComponentModel("shared"),o=this.getI18nModel(),r=this.getControl("idQuickLinkList"),n=o.getResourceBundle();t.setProperty("/SaveQuickLinkButton",true);t.setProperty("/AddQuickLinkButton",false);s.setProperty("/createQuickLinks/createUpdateQuickLinkTitle",n.getText("editQuickLinks"));this._oSelectedQuickLinkItem=e.getSource();s.setProperty("/oSelectedQuickLink",this._oSelectedQuickLinkItem.getBindingContext("shared").getObject());if(s.getProperty("/oSelectedQuickLink/quickLink_name")){this.onPressCreateUpdateQuickLinks()}},setWorkList:function(){var e=[{ServiceOrderID:"1001",Description:"Description1",Status:"Open",Priority:2,PriorityText:"High",DueBy:new Date},{ServiceOrderID:"1010",Description:"Description2",Status:"In progress",Priority:1,PriorityText:"Low",DueBy:new Date(2021,4,19)},{ServiceOrderID:"1011",Description:"Description3",Status:"In progress",Priority:1,PriorityText:"Low",DueBy:new Date(2020,1,12)},{ServiceOrderID:"1100",Description:"Description4",Status:"Open",Priority:2,PriorityText:"High",DueBy:new Date(2021,6,23)},{ServiceOrderID:"1101",Description:"Description5",Status:"In progress",Priority:2,PriorityText:"High",DueBy:new Date}];var t=[{TaskID:"1110",Description:"Description1",Status:"In progress",Priority:1,PriorityText:"Low",DueBy:new Date(2021,0,21)},{TaskID:"1111",Description:"Description2",Status:"In progress",Priority:1,PriorityText:"Low",DueBy:new Date(2021,1,22)},{TaskID:"1000",Description:"Description3",Status:"Open",Priority:2,PriorityText:"High",DueBy:new Date(2021,3,21)},{TaskID:"1001",Description:"Description4",Status:"In progress",Priority:1,PriorityText:"Low",DueBy:new Date(2021,4,19)},{TaskID:"1011",Description:"Description5",Status:"Open",Priority:2,PriorityText:"High",DueBy:new Date(2021,5,21)}];var i=this.getComponentModel("shared");i.setProperty("/openServiceOrder",e);i.setProperty("/openTask",t)},onSelectionChangeSegmentedButton:function(e){var t=e.getSource(),s=t.getSelectedKey(),o=this.getComponentModel("visibility");if(s===i.SegmentedItem.OpenServiceOrder){o.setProperty("/OpenServiceOrderTableVisibility",true);o.setProperty("/OpenTaskTableVisibility",false)}else if(s===i.SegmentedItem.OpenTask){o.setProperty("/OpenServiceOrderTableVisibility",false);o.setProperty("/OpenTaskTableVisibility",true)}o.updateBindings()},handlePopoverPress:function(e){var i=e.getSource(),s=this.getView();this.listPath=i.getBindingContext("shared").getPath();var o=this.getComponentModel("shared").getProperty(this.listPath);var n=new t({data:o});if(!this.oPopoverDialog){this.oPopoverDialog=r.load({id:s.getId(),name:"com.sap.acs.ui.dashboard.view.fragments.Popover",controller:this}).then(function(e){s.addDependent(e);return e})}this.oPopoverDialog.then(function(e){e.setModel(n,"popOverData");e.openBy(i)})},onPressMessagePopoverButton:function(e){var t=e.getSource(),i=this.getView();if(!this.oMessagePopoverDialog){this.oMessagePopoverDialog=r.load({id:i.getId(),name:"com.sap.acs.ui.dashboard.view.fragments.MessagePopover",controller:this}).then(function(e){i.addDependent(e);return e})}this.oMessagePopoverDialog.then(function(e){e.openBy(t)})},setError:function(e){var t=this.getComponentModel("visibility");var i=this.getControl("idMessagePopoverButton");t.setProperty("/FooterVisibility",true);this.setDataMessagePopover(e);i.firePress()},setFooterVisibleError:function(e){var t=this.getComponentModel("visibility");if(!e.length){t.setProperty("/FooterVisibility",false)}},setDataMessagePopover:function(e){var t=this.getControl("idMessagePopover");var s=this.getComponentModel("message");this.aMessage.push({title:e,description:e,type:i.SpotsType.Error});s.setProperty("/item",this.aMessage);s.setProperty("/messageSize",this.aMessage.length);s.updateBindings(true)},onBeforeCloseMessagePopover:function(){this.oMessagePopoverDialog.then(function(e){e.destroy()});this.oMessagePopoverDialog=undefined}})});